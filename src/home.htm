<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">
  <title data-bind="i18n: 'openevse'">OpenEVSE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <meta name="description" content="OpenEVSE">
  <meta name="author" content="OpenEVSE">
  <meta name="theme-color" content="#000000" />
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
  <link rel="apple-touch-icon" href="favicon-180.png" sizes="180x180">
  <link rel="apple-touch-icon" href="favicon-167.png" sizes="167x167">
  <link rel="apple-touch-icon" href="favicon-152.png" sizes="152x152">

</head>

<body>
  <div id="page">
    <div class="header">
      <h1>Open<span>EVSE</span></h1>
      <h3>WiFi</h3>
    </div>

    <div class="container" data-bind="visible: !initialised()">
      <span data-bind="i18n: 'loading'"></span>(<span data-bind="text: itemsLoaded"></span>/<span data-bind="text: itemsTotal"></span>)
    </div>

    <div class="container" data-bind="visible: initialised" style="display: none">

      <div class="tabs">
        <input id="tab-3" type="radio" name="tab-group" data-bind="checked: tab" value="status" />
        <label for="tab-3" data-bind="i18n: 'openevse'">OpenEVSE</label>
        <input id="tab-1" type="radio" name="tab-group" data-bind="checked: tab" value="system" />
        <label for="tab-1" data-bind="i18n: 'system'">System</label>
        <input id="tab-2" type="radio" name="tab-group" data-bind="checked: tab" value="services" />
        <label for="tab-2" data-bind="i18n: 'services'">Services</label>
        <input id="tab-4" type="radio" name="tab-group" data-bind="checked: tab" value="rapi" />
        <label for="tab-4" data-bind="visible: developerMode() &amp;&amp; status.evse_connected()">RAPI</label>
        <input id="tab-5" type="radio" name="tab-group" data-bind="checked: tab" value="vehicle" />
        <label for="tab-5" data-bind="i18n: 'vehicle'">Vehicle</label>
      </div>

      <div id="content">
        <!--TAB 1: System -->
        <div id="content-1" data-bind="visible: isSystem">

          <div class="box380 left">
            <h2 data-bind="i18n: 'wifisetup'">WiFi Setup</h2>
            <p><b data-bind="i18n: 'mode'">Mode:</b> <span id="mode" data-bind="text: status.fullMode"></span></p>

            <div id="wired-view" data-bind="visible: status.isWired">
              <p><b data-bind="i18n: 'ip'">IP Address:</b><br><a data-bind="text: status.ipaddress, attr: {href: 'http://'+status.ipaddress()}"></a></p>
              <p>
                <b data-bind="i18n: 'sfpackets'">Successful packets:</b><br>
                <span data-bind="text: status.packets_success"></span><span data-bind="i18n: 'of'"> of </span><span data-bind="text: status.packets_sent"></span>
              </p>
              <p><b data-bind="i18n: 'openevse'">OpenEVSE</b></p>
              <p><b data-bind="i18n: 'rapipackets'">RAPI packets:</b><br><span data-bind="text: status.comm_success"></span><span data-bind="i18n: 'of'"></span> of <span data-bind="text: status.comm_sent"></span></p>
            </div>

            <div id="client-view" data-bind="visible: !wifi.canConfigure() &amp;&amp; !wifi.wifiConnecting() &amp;&amp; !status.isWired()">
              <table>
                <tr>
                  <th data-bind="i18n: 'network'">Network</th>
                  <th data-bind="i18n: 'rssi'">RSSI dBm</th>
                </tr>
                <tbody id="sta-ssid">
                  <tr data-bind="click: function () { wifi.forceConfig(true); }">
                    <td data-bind="text: config.ssid"></td>
                    <td data-bind="text: status.srssi"></td>
                  </tr>
                </tbody>
              </table>
              <button data-bind="i18n: 'changewifi', click: function () { wifi.forceConfig(true); }">Change WiFi network</button>
              <p><b data-bind="i18n: 'ip'">IP Address:</b><br><a data-bind="text: status.ipaddress, attr: {href: 'http://'+status.ipaddress()}"></a></p>
              <p>
                <b data-bind="i18n: 'sfpackets'">Successful packets:</b><br>
                <span data-bind="text: status.packets_success"></span><span data-bind="i18n: 'of'"> of </span> <span data-bind="text: status.packets_sent"></span>
              </p>
              <p><b data-bind="i18n: 'openevse'">OpenEVSE</b></p>
              <p><b data-bind="i18n: 'rapipackets'">RAPI packets:</b><br><span data-bind="text: status.comm_success"></span><span data-bind="i18n: 'of'"> of </span><span data-bind="text: status.comm_sent"></span></p>
              <button id="apoff" data-bind="i18n: 'poffaccesspoint', visible: status.isWifiAccessPoint, click: wifi.turnOffAccessPoint, disable: wifi.turnOffAccessPointFetching">Turn off Access Point</button>
            </div>

            <div id="ap-view" data-bind="visible: wifi.canConfigure() &amp;&amp; !wifi.wifiConnecting() &amp;&amp; !status.isWired()">
              <p data-bind="i18n: 'connect2net'">Connect to network:</p>

              <div id="wifiList">
                <ul class="list-group" data-bind="foreach: scan.filteredResults, visible: 0 != scan.results().length">
                  <li class="list-group-item" data-bind="click: $root.wifi.select, css: { active: $root.wifi.selectedNet() === $data }">
                    <span  data-bind="text: ssid"></span>
                    <img width="24px" height="24px" data-bind="attr:{src: 'wifi_signal_'+strength()+'.svg'}" />
                  </li>
                </ul>
              </div>

              <div data-bind="i18n: 'scanning', visible: 0 == scan.results().length">
                Scanning...
              </div>

              <p>
                <b data-bind="i18n: 'ssid'">SSID:</b><br>
                <input type="text" autocapitalize="none" data-bind="textInput: config.ssid">
              </p>
              <p>
                <b data-bind="i18n: 'passkey'">Passkey:</b><br>
                <input type="text" autocapitalize="none" data-bind="textInput: wifiPassword.value, attr: { type: wifiPassword.show() ? 'text' : 'password' }"><br/>
                <div>
                  <input id="wifipassword" type="checkbox" data-bind="checked: wifiPassword.show" />
                  <label for="wifipassword" data-bind="i18n: 'showpass'">Show password</label>
                </div>
              </p>
              <p>
                <button data-bind="i18n: 'connect', click: wifi.saveNetwork, text: (wifi.saveNetworkFetching() ? i18nextko.t('saving') : (wifi.saveNetworkSuccess() ? i18nextko.t('saved') : i18nextko.t('connect'))), disable: wifi.saveNetworkFetching">Connect</button>
              </p>
            </div>

            <div data-bind="visible: wifi.wifiConnecting">
              <p data-bind="i18n: 'connecting'">Connecting to WIFI Network...</p>
            </div>
          </div>

          <div class="box380 right">
            <h2 data-bind="i18n: 'administration'">Administration</h2>
            <p>
              <b data-bind="i18n: 'username'">Username:</b><br>
              <input type="text" autocapitalize="none" data-bind="textInput: config.www_username" pattern=".{15}" title="The field requires 15 characters" maxlength="15" required="">
              <span class="small-text validMessage" data-bind="i18n: '15max'">15 characters max</span>
            </p>
            <p>
              <b data-bind="i18n: 'password'">Password:</b><br>
              <input type="password" autocapitalize="none" data-bind="textInput: wwwPassword.value, attr: { type: wwwPassword.show() ? 'text' : 'password' }" pattern=".{15}" title="The field requires 15 characters" maxlength="15" required="" /><br />
              <span>
                <input id="wwwPassword" type="checkbox" data-bind="checked: wwwPassword.show" />
                <label for="wwwPassword" data-bind="i18n: 'showpassword'">Show password</label>
              </span><br />
              <span class="small-text validMessage" data-bind="i18n: '15max'" >15 characters max</span><br>
              <span class="small-text" data-bind="i18n: 'httpauth'">Web interface HTTP authentication.</span><br><br>
              <button data-bind="i18n: 'save', click: saveAdmin, text: (saveAdminFetching() ? i18nextko.t('saving') : (saveAdminSuccess() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: saveAdminFetching">Save</button>
            </p>
          </div>

          <div class="box380 left">
            <h2 data-bind="i18n: 'language'">Language</h2>
            <select data-bind="options: languages, value: config.lang, valueAllowUnset: false">
            </select>
            <button data-bind="i18n: 'save', click: saveLang, text: (saveLangFetching() ? i18nextko.t('saving') : (saveLangSuccess() ? i18nextko.t('saved') : i18nextko.t('Save') )), disable: saveLangFetching">Save</button>
          </div>

          <div class="box380 right">
            <h2 data-bind="i18n: 'wififirmware'">WiFi Firmware</h2>
            <p><b data-bind="i18n: 'version'">Version: </b><span data-bind="text: config.version"></span></p>
            <div data-bind="visible: !updateFetching() && !updateComplete()">
              <form action="#" method="post" enctype="multipart/form-data" id="upload_form" data-bind="submit: otaUpdate">
                <input type="file" name="update" data-bind="value: updateFilename">
                <button data-bind="i18n: 'update', click: otaUpdate, text: (updateFetching() ? i18nextko.t('updating') : i18nextko.t('update')), disable: ('' == updateFilename())">Update</button>
              </form>
            </div>
            <div data-bind="visible: (updateError() !== '')" class="box error">
              <h4><span data-bind="i18n: 'error'">Error</span>:</h4>
              <span data-bind="text: updateError"></span>
            </div>
            <div data-bind="i18n: 'updating', visible: updateFetching() && !updateComplete()">
              Updating... <br/>
              <div id="progressBack">
                <div id="progressBar" data-bind="style: { width: updateProgress()+'%' }"></div>
              </div>
            </div>
            <div  data-bind="i18n: 'complete', visible: updateComplete">
              Firmware update completed ok
            </div>
            <p>
              <button data-bind="i18n: 'restart', click: restart, text: (restartFetching() ? i18nextko.t('restarting') : i18nextko.t('restart')), disable: restartFetching">Restart</button>
              <button data-bind="i18n: 'reset', click: factoryReset, text: (factoryResetFetching() ? i18nextko.t('resetting') : i18nextko.t('reset') ), disable: factoryResetFetching">Factory Reset</button>
            </p>
          </div>

          <div class="box380 left" data-bind="visible: advancedMode()">
            <h2 data-bind="i18n: 'advsettings'">Advanced Settings</h2>
            <p data-bind="visible: false !== config.hostname()">
              <b data-bind="i18n: 'hostname'">Hostname:</b><br>
              <input type="text" autocapitalize="none" data-bind="textInput: config.hostname" pattern=".{31}" title="The field max 31 characters" maxlength="31" required="">
              <span class="small-text validMessage" data-bind="i18n: '31max'">31 characters max</span>
            </p>
            <p data-bind="visible: false !== config.sntp_hostname()">
              <b data-bind="i18n: 'ntpserver'">NTP Server:</b><br>
              <input type="text" autocapitalize="none" data-bind="textInput: config.sntp_hostname" pattern=".{31}">
            </p>
            <p>
              <button data-bind="i18n: 'save', click: advancedGroup.save, text: (advancedGroup.fetching() ? i18nextko.t('saving') : (advancedGroup.success() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: advancedGroup.fetching">Save</button>
            </p>
          </div>

          <div class="box380 right" data-bind="visible: false !== status.rfid_failure()">
            <h2 data-bind="i18n: 'rfid'">RFID</h2>
            <b data-bind="i18n: 'enabled'">Enabled: </b>
            <label class="switch">
              <input type="checkbox" data-bind="checked: config.rfid_enabled, click: function() {rfidGroup.save(); return true;}" />
              <div class="slider round"></div>
            </label>
            <span data-bind="i18n: 'rfidnotfound', visible: status.rfid_failure() && config.rfid_enabled()" style="color:darkred; margin-left: 8px">Reader not found</span>
            <br>
            <div data-bind="visible: config.rfid_storage() != ''">
              <h3 data-bind="i18n: 'rfidregistered'">Registered tags</h3>
              <div id="stored_tags_list">
                <ul class="list-group" data-bind="foreach: config.rfid_storage().split(',')">
                  <li class="list-group-item" data-bind="visible: $data">
                    <span data-bind="text: $data" style="font-family: 'Courier New', monospace;"></span>
                    <span style="float: right"><a style="cursor: pointer;" data-bind="i18n: 'remove', click: $parent.removeRFIDTag">Remove</a></span>
                  </li>
                </ul>
              </div>
              <button data-bind="i18n: 'rfidclear', click: clearRFIDTags">Clear tags</button>
            </div>
            <div>
              <!--b>UID:</b><br>
              <input style="float: left" type="text" autocapitalize="none" data-bind="textInput: config.sntp_hostname"><br>
              <button onclick="window.open('term.html?debug');">Add</button-->
              <div data-bind="visible: config.rfid_enabled">
                <h3 data-bind="i18n: 'rfidmanage'">Manage scanned tag</h3>
                <button data-bind="i18n: 'rfidscan', click: waitForRFID, disable: status.rfid_waiting() > 0">Scan</button>
                <div data-bind="visible: status.rfid_waiting() > 0">
                  <b data-bind="i18n: 'rfidplace'">Place your RFID tag on the scanner... <span data-bind="text: (status.rfid_waiting() >= 5 ? status.rfid_waiting() : i18nextko.t('waiting'))"></span></b>
                </div>
                <div data-bind="visible: status.rfid_input()">
                  <b data-bind="i18n: 'rfidscanned'">Tag scanned successfully!</b>
                  <h3 data-bind="i18n: 'rfiduid'">UID: <span data-bind="text: status.rfid_input"></span></h3>
                  <div>
                    <span data-bind="text: config.rfid_storage().split(',').includes(status.rfid_input()) ? i18nextko.t('rfidalregistered') : i18nextko.t('rfidnotregistered')"></span><br>
                    <button data-bind="i18n: 'rfidregister', visible: !config.rfid_storage().split(',').includes(status.rfid_input()), click: function(data, event) { addRFIDTag(status.rfid_input()); status.rfid_input('') }">Register tag</button>
                    <button data-bind="i18n: 'rfidremove', visible:  config.rfid_storage().split(',').includes(status.rfid_input()), click: function(data, event) { removeRFIDTag(status.rfid_input()); status.rfid_input('') }">Remove tag</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="box380 left">
            <h2 data-bind="i18n: 'devmode'">Developer Mode</h2>
            <div>
              <b data-bind="i18n: 'enabled'">Enabled: </b>
              <label class="switch">
                <input type="checkbox" data-bind="checked: developerMode">
                <div class="slider round"></div>
              </label>
            </div>
            <h3 data-bind="i18n: 'serialconsoles'">Serial Consoles</h3>
            <div>
              <button onclick="window.open('term.html?debug');" data-bind="i18n: 'debug'">Debug</button>
              <button onclick="window.open('term.html?evse');" data-bind="i18n: 'openevse'">OpenEVSE</button>
            </div>
          </div>
        </div>
        <!--end content 1-->

        <!--TAB 2: Services -->
        <div id="content-2" data-bind="visible: isServices">
          <div class="box380 left">
            <h2><span data-bind="i18n: 'emoncms'">Energy Monitoring</span> <img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="emoncms.jpg" align="left" /></h2>
            <p>
              <input type="checkbox" id="emoncms_enabled" data-bind="checked: config.emoncms_enabled" />
              <label for="emoncms_enabled"><b data-bind="i18n: 'emoncmsenable'">Enable Emoncms</b></label>
            </p>
            <div data-bind="visible: config.emoncms_enabled">
              <div><b data-bind="i18n: 'emoncmsserver'">Emoncms Server*:</b></div>
              <div data-bind="css: { protocol: config.http_supported_protocols().length > 0 }">
                <select data-bind="visible: config.http_supported_protocols().length > 0,
                  options: config.http_supported_protocols,
                  optionsText: function(item) {
                    return item + '://'
                  },
                  value: emoncms_protocol"></select>
                <input type="text" autocapitalize="none" data-bind="textInput: emoncms_server">
              </div>
              <div class="small-text">e.g:
                <a href="https://data.openevse.com/emoncms">data.openevse.com/emoncms</a>,
                <a href="https://emoncms.org">emoncms.org</a>,
                <a href="http://emonpi">emonpi</a>
              </div>
            </div>
            <p data-bind="visible: config.emoncms_enabled">
              <b data-bind="i18n: 'emoncmsnode'">Emoncms Node*:</b><br>
              <input type="text" autocapitalize="none" data-bind="textInput: config.emoncms_node">
            </p>
            <p data-bind="visible: config.emoncms_enabled">
              <b data-bind="i18n: 'emoncmsapi'">Emoncms write-apikey*:</b><br />
              <input type="password" autocapitalize="none" data-bind="textInput: emoncmsApiKey.value, attr: { type: emoncmsApiKey.show() ? 'text' : 'password' }" /><br />
              <span>
                <input id="emoncmsApiKey" type="checkbox" data-bind="checked: emoncmsApiKey.show" />
                <label for="emoncmsApiKey" data-bind="i18n: 'showpass'">Show password</label>
              </span>
            </p>
            <p data-bind="visible: config.emoncms_enabled && config.http_supported_protocols().length === 0">
              <b data-bind="i18n: 'emoncmsssltitle'">Emoncms SSL SHA-1 Fingerprint (optional):</b><br>
              <input type="text" autocapitalize="none" data-bind="textInput: config.emoncms_fingerprint"><br>
              <br><span class="small-text" data-bind="i18n: 'emoncmshttps'">HTTPS will be enabled if present e.g:</span>
              <span class="small-text">
                7D:82:15:BE:D7:BC:72:58:87:7D:8E:40:D4:80:BA:1A:9F:8B:8D:DA
              </span>
            </p>
            <p>
              <button data-bind="i18n: 'save', click: saveEmonCms, text: (saveEmonCmsFetching() ? i18nextko.t('saving') : (saveEmonCmsSuccess() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: saveEmonCmsFetching">Save</button>
            </p>
            <p>
              <span data-bind="visible: config.emoncms_enabled"><b>&nbsp; <span data-bind="i18n: 'connected'">Connected:</span>&nbsp;<span data-bind="text: 1 === status.emoncms_connected() ? i18nextko.t('yes') : i18nextko.t('no')"></span></b></span>
              <span data-bind="visible: config.emoncms_enabled() &amp;&amp; 1 === status.emoncms_connected()"><b>&nbsp; <span data-bind="i18n: 'emoncmssuccess'">Successful posts:</span>&nbsp;<span data-bind="text: status.packets_success"></span></b></span>
            </p>
            <p data-bind="visible: config.emoncms_enabled() &amp;&amp; 0 === status.emoncms_connected() &amp;&amp; false !== status.emoncms_message(), text: status.emoncms_message"></p>
          </div>
          <!-- MQTT -->
          <div class="box380 right">
            <h2><img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="mqtt.png" align="left" /><span data-bind="i18n: 'mqtt'">MQTT</span></h2>
            <p>
              <input type="checkbox" id="mqtt_enabled" data-bind="checked: config.mqtt_enabled" />
              <label for="mqtt_enabled"><b data-bind="i18n: 'mqttenable'">Enable MQTT</b></label>
              <span class="info" data-bind="click: toggle.bind($data, showMqttInfo)"></span>
            </p>
            <div class="box" data-bind="visible: showMqttInfo">
              <div>
                <span data-bind="i18n: 'mqttstatuspub'">Status published to:</span><br/>
                <span class="small-text" data-bind="i18n: 'mqttstatusval'">{base-topic}/{status} value</span><br>
                <span class="small-text"><span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/amp 16</span><br>
              </div>
              <p>
                <a href="https://openevse.stoplight.io/docs/openevse-wifi-v4/c2NoOjIwNzU1Mjkx-evse-claim"><span class="small-text" data-bind="i18n: 'mqttraspi'">RAPI over MQTT is deprecated. Use /claim or /override API</span></a><br>
                Claim<br/>
                <span class="small-text">{base-topic}/claim/set <a href="https://openevse.stoplight.io/docs/openevse-wifi-v4/c2NoOjIwNzU1Mjkx-evse-claim" target="_blank">{json}</a></span><br>
                <span class="small-text">get claim: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/claim</span><br>
                <span class="small-text">set claim: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/claim/set {'charge_current': 30, 'state': 'active'} </span><br>
                <span class="small-text">release claim: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/claim/set release</span><br>
              </p>
              <p>
                Override<br/>
                <span class="small-text">{base-topic}/override/set <a href="https://openevse.stoplight.io/docs/openevse-wifi-v4/13661f6589784-get-the-manual-override-status" target="_blank">{json]</a></span><br>
                <span class="small-text">get override: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/override</span><br>
                <span class="small-text">set override: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/override/set {'charge_current': 30, 'state': 'active'}</span><br>
                <span class="small-text">clear override: <span data-bind="text: '' !== config.mqtt_topic() ? config.mqtt_topic() : 'openevse'"></span>/override clear</span><br>
              </p>
            </div>
            <div data-bind="visible: config.mqtt_enabled">
              <b data-bind="i18n: 'host'">Host*:</b><br>
              <div data-bind="css: { protocol: config.mqtt_supported_protocols().length > 0 }">
                <select data-bind="visible: config.mqtt_protocol_enable,
                                    options: config.mqtt_supported_protocols,
                                    optionsText: function(item) {
                                      return item + '://'
                                    },
                                    value: config.mqtt_protocol"></select>
                <input data-bind="textInput: config.mqtt_server" type="text" autocapitalize="none"><br/>
                <span class="small-text">e.g 'emonpi', 'test.mosquitto.org', '192.168.1.4'</span>
              </div>
            </div>
            <p data-bind="visible: config.mqtt_enabled() &amp;&amp; config.mqtt_port_enable()">
              <b data-bind="i18n: 'port'">Port*:</b><br>
              <input data-bind="textInput: config.mqtt_port" type="number" min="0" max="65535" autocapitalize="none"><br/>
            </p>
            <div data-bind="visible: config.mqtt_enabled() &amp;&amp; config.mqtt_reject_unauthorized_enable() &amp;&amp; advancedMode()">
              <b data-bind="i18n: 'rejectcert'">Reject self-signed certificates:</b>
              <label class="switch">
                <input type="checkbox" data-bind="checked: config.mqtt_reject_unauthorized" />
                <div class="slider round"></div>
              </label>
            </div>
            <div data-bind="visible: config.mqtt_enabled() &amp;&amp; !config.mqtt_reject_unauthorized()" class="box warning" style="margin-top: 20px;">
              <h4 data-bind="i18n: 'warning'">Warning!!</h4>
              <span data-bind="i18n: 'mqttcerts'">Certificate validation is disabled, although the connection to MQTT server will be encrypted the connection is still
              vulnerable to man-in-the-middle attacks.</span>
            </div>
            <p data-bind="visible: config.mqtt_enabled">
              <b data-bind="i18n: 'username'">Username:</b><span data-bind="i18n: 'blank'"> blank - no authentication</span>
              <input data-bind="textInput: config.mqtt_user" type="text" autocapitalize="none">
            </p>
            <p data-bind="visible: config.mqtt_enabled">
              <b data-bind="i18n: 'password'">Password:</b><span data-bind="i18n: 'blank'"> blank - no authentication</span>
              <input type="password" autocapitalize="none" data-bind="textInput: mqttPassword.value, attr: { type: mqttPassword.show() ? 'text' : 'password' }" /><br />
              <span>
                <input id="mqttPassword" type="checkbox" data-bind="checked: mqttPassword.show" />
                <label for="mqttPassword" data-bind="i18n: 'showpass'">Show password</label>
              </span>
            </p>
            <p data-bind="visible: config.mqtt_enabled">
              <b data-bind="i18n: 'basetopic'">Base-topic*:</b><br>
              <input data-bind="textInput: config.mqtt_topic" type="text" autocapitalize="none"><br/>
              <span class="small-text">e.g 'openevse'</span>
            </p>
            <div data-bind="visible: config.mqtt_enabled() ">
              <b data-bind="i18n: 'retain'">Retain published data</b>
              <label class="switch">
                <input type="checkbox" data-bind="checked: config.mqtt_retained" />
                <div class="slider round"></div>
              </label>
            </div>
            <p data-bind="visible: config.mqtt_enabled">
              <b data-bind="i18n: 'voltagetop'">Voltage topic:</b>
              <input data-bind="textInput: config.mqtt_vrms" type="text" autocapitalize="none" hint="emon/emonpi/vrms"><br>
              <span class="small-text" data-bind="i18n: 'voltagedesc'">Voltage MQTT topic to improve power calculations</span>
            </p>
            <p>
              <button data-bind="i18n: 'save', click: mqttGroup.save, text: (mqttGroup.fetching() ? i18nextko.t('saving') : (mqttGroup.success() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: mqttGroup.fetching">Save</button>
              <span data-bind="visible: config.mqtt_enabled"><b>&nbsp; <span data-bind="i18n: 'connected'"> Connected:</span>&nbsp;<span data-bind="text: 1 === status.mqtt_connected() ? i18nextko.t('yes') : i18nextko.t('no')"></span></b></span>
            </p>
          </div>
          <!-- Current Shaper -->
          <div class="box380 left">
            <h2><img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="shaper.png" align="left" /><span data-bind="i18n: 'shaper'">Current Shaper</span></h2>
            <p>
              <input type="checkbox" id="current_shaper_enabled" data-bind="checked: config.current_shaper_enabled" />
              <label for="current_shaper_enabled"><b data-bind="i18n: 'shaperenable'">Enable Current Shaper</b></label>
            </p>
            <p data-bind="i18n: 'shaperdesc', visible: config.current_shaper_enabled">
              Throttle charge current following your house loads to prevent exceeding what your energy plan can deliver.<br>
            </p>
            <p data-bind="visible: config.current_shaper_enabled">
              <b data-bind="i18n: 'shapermaxpow'">Max power allowed (in W):</b><br>
              <input data-bind="textInput: config.current_shaper_max_pwr" type="number" />
            </p>
            <p data-bind="visible: config.current_shaper_enabled">
              <b data-bind="i18n: 'shaperlivepow'">Live power load MQTT Topic (in W):</b>
              <input data-bind="textInput: config.mqtt_live_pwr" type="text" />
            </p>
            <p>
              <button data-bind="i18n: 'save', click: saveCurrentShaper, text: (saveCurrentShaperFetching() ? i18nextko.t('saving') : (saveCurrentShaperSuccess() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: saveCurrentShaperFetching">Save</button>
            </p>
          </div>

          <!-- Ohm -->
          <div class="box380 left">
            <h2><span data-bind="i18n: 'ohm'">OhmConnect</span><img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="ohm.jpg" align="left"></h2>
            <p>
              <input type="checkbox" id="ohm_enabled" data-bind="checked: config.ohm_enabled" />
              <label for="ohm_enabled"><b data-bind="i18n: 'ohmenable'">Enable OhmConnect</b></label>
              <a href="https://ohm.co/openevse" rel="nofollow" data-bind="i18n: 'ohmclick'">Click Here to Join</a>
            </p>
            <p data-bind="i18n: 'ohmdesc', visible: config.ohm_enabled">
              OhmConnect monitors real-time conditions on the electricity grid. When dirty and unsustainable power plants turn
              on, our users receive a notification to save energy.
            </p>
            <p data-bind="visible: config.ohm_enabled">
              <b data-bind="i18n: 'ohmhour'">Ohm Hour:</b> <span data-bind="text: status.ohm_hour"></span>
            </p>
            <p data-bind="visible: config.ohm_enabled">
              <b data-bind="i18n: 'ohmkey'">Ohm key:</b><br>
              <input data-bind="textInput: config.ohmkey" type="text" autocapitalize="none">
            </p>
            <p data-bind="visible: config.ohm_enabled">
              <strong data-bind="i18n: 'ohmusa'">USA - California only</strong>
            </p>
            <p data-bind="visible: config.ohm_enabled">
              <span data-bind="i18n: 'ohmkeydesc'">Ohm Key can be obtained by logging in to OhmConnect, enter Settings and locate the link in "Open Source Projects".<br/>
              Example: https://login.ohmconnect.com/verify-ohm-hour/OpnEoVse</span><br/>
              <b data-bind="i18n: 'key'">Key: </b>OpnEoVse
            </p>
            <p>
              <button data-bind="i18n: 'save', click: saveOhmKey, text: (saveOhmKeyFetching() ? i18nextko.t('saving') : (saveOhmKeySuccess() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: saveOhmKeyFetching">Save</button>
            </p>
          </div>

          <!-- Divert Mode -->
          <div class="box380 right">
            <h2><span data-bind="i18n: 'divert'">Solar PV divert</span><img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="solar.png" align="left"></h2>

            <p data-bind="visible: config.mqtt_enabled">
              <input type="checkbox" id="divert_enabled" data-bind="checked: config.divert_enabled" />
              <label for="divert_enabled"><b data-bind="i18n: 'divertenable'">Enable Solar PV Divert</b></label>
              <span class="info" data-bind="click: toggle.bind($data, showSolarDivert)"></span>
            </p>

            <div class="box error" data-bind="visible: !config.mqtt_enabled()">
              <h4 data-bind="i18n: 'nomqtt'">MQTT not enabled.</h4>
              <span data-bind="i18n: 'divertnomqttdesc'">Solar PV Divert requires an SolarPV-gen or Grid (+I/-E) feed to be delivered via MQTT.</span>
            </div>

            <div class="box" data-bind="visible: showSolarDivert()">
              <div data-bind="i18n: 'divertdesc1'">Dynamically adjust charge rate based on solar PV generation or excess power (grid export).</div>
              <p>
                <ul>
                  <li><span class="small-text" data-bind="i18n: 'divertdesc2'">If only solar PV feed available: charge rate is modulated based on <b>solar PV generation.</b></span></li>
                  <li><span class="small-text" data-bind="i18n: 'divertdesc3'">If grid +I/-E (positive Import / negative Export) feed is available: charge rate will be modulated by available  <b>excess power.</b></span></li>
                  <li><span class="small-text" data-bind="i18n: 'divertdesc4'">If EVSE is sleeping: charging will begin when solar PV / excess power is greater than min charge rate.</span></li>
                  <li><span class="small-text" data-bind="i18n: 'divertdesc5'">Charging will pause if the excess power drops below the min charge rate for a period of time.</span></li>
                </ul>
                <span class="small-text"><i data-bind="i18n: 'divertnote'">Note: It's assumed that EVSE power is included in the grid feed</i></span><br>
              </p>
            </div>

            <p data-bind="visible: config.divert_enabled() &amp;&amp; config.mqtt_enabled()">
              <br>
              <span data-bind="visible: divertFeedType() === 'solar'"><b data-bind="i18n: 'divertsolar'">Solar:</b></span>
              <span data-bind="visible: divertFeedType() === 'grid_ie'"><b data-bind="i18n: 'divertgrid'">Grid Import/Export:</b></span>
              <span data-bind="text: divertFeedType() === 'grid_ie' ? status.grid_ie() : status.solar()"></span>W -
              <span data-bind="text: formatUpdate(openevse.time.divert_update()), css: updateClass(openevse.time.divert_update())"></span>
              <span data-bind="visible: ecoMode"> | <b data-bind="i18n: 'chargerate'">Charge rate:</b> <span data-bind="text: status.charge_rate"></span>A</span>
            </p>

            <div data-bind="visible: config.divert_enabled() &amp;&amp; config.mqtt_enabled()">
              <b data-bind="i18n: 'divertfeed'">Feed*:</b><br>
              <div class="divert">
                <select data-bind="value: divertFeedType">
                  <option value="solar" data-bind="i18n: 'divertsolar2'">SolarPV-gen</option>
                  <option value="grid_ie" data-bind="i18n: 'divertgrid2'">Grid (+I/-E)</option>
                </select>
                <input data-bind="textInput: divertFeedValue" type="text" autocapitalize="none"><br/>
                <span data-bind="i18n: 'divertsolar2desc', visible: divertFeedType() === 'solar'" class="small-text" >Solar PV MQTT topic to modulate charge rate based on solar</span>
                <span data-bind="i18n: 'divertgrid2desc', visible: divertFeedType() === 'grid_ie'" class="small-text">Grid (+I/-E) MQTT topic to modulate charge rate based on <b>excess power</b></span>
              </div>
            </div>

            <p data-bind="visible: advancedMode() &amp;&amp; config.divert_enabled() &amp;&amp; config.mqtt_enabled() &amp;&amp; divertFeedType() === 'grid_ie'">
              <b data-bind="i18n: 'divertpvpratio'">Required PV power ratio:</b><br>
              <input data-bind="textInput: config.divert_PV_ratio" type="number" autocapitalize="none" hint="1.1" min="0.05" max="1.5" step="0.01"><br>
              <span class="small-text" data-bind="i18n: 'divertpvpratiodesc'">The fraction of PV current that suffices to start charging or increment current </span>
            </p>

            <p data-bind="visible: advancedMode() &amp;&amp; config.divert_enabled() &amp;&amp; config.mqtt_enabled()">
              <b data-bind="i18n: 'divertsmoothatt'">Divert smoothing attack:</b><br>
              <input data-bind="textInput: config.divert_attack_smoothing_factor" type="number" autocapitalize="none" hint="0.4" min="0" max="1" step="0.01"><br>
              <span class="small-text" data-bind="i18n: 'divertsmoothattdesc'">The amount of the new feed value to add to the divert available power rolling average </span>
            </p>

            <p data-bind="visible: advancedMode() &amp;&amp; config.divert_enabled() &amp;&amp; config.mqtt_enabled()">
              <b data-bind="i18n: 'divertsmoothdec'">Divert smoothing decay:</b><br>
              <input data-bind="textInput: config.divert_decay_smoothing_factor" type="number" autocapitalize="none" hint="0.05" min="0" max="1" step="0.01"><br>
              <span class="small-text" data-bind="i18n: 'divertsmoothdecdesc'">The amount of the new feed value to remove to the divert available power rolling average </span>
            </p>

            <p data-bind="visible: advancedMode() &amp;&amp; config.divert_enabled() &amp;&amp; config.mqtt_enabled()">
              <b data-bind="i18n: 'divertmintime'">Minimum charge time:</b><br>
              <input data-bind="textInput: config.divert_min_charge_time" type="number" autocapitalize="none" hint="600" min="0" max="100000" step="10"><br>
              <span class="small-text" data-bind="i18n: 'divertmintimedesc'">The minimum amount of time (seconds) to charge the car once enabled via the Solar PV divert. This can help minimise wear and tear on the EVSE.</span>
            </p>

            <p>
              <button data-bind="i18n: 'save', click: divertGroup.save, text: (divertGroup.fetching() ? i18nextko.t('saving') : (divertGroup.success() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: divertGroup.fetching">Save</button>
            </p>
          </div>

          <div class="box380 left">
            <h2><span data-bind="i18n: 'ocpp'">OCPP 1.6</span><img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="arduinoocpp.png" align="left"></h2>
            <p>
              <input type="checkbox" id="ocpp_enabled" data-bind="checked: config.ocpp_enabled" />
              <label for="ocpp_enabled"><b data-bind="i18n: 'ocppenable'">Enable OCPP</b></label>
            </p>
            <div data-bind="visible: config.ocpp_enabled">
              <b data-bind="i18n: 'ocppserver'">Central System URL*:</b><br>
              <input data-bind="textInput: config.ocpp_server" type="text" autocapitalize="none"><br/>
              <span class="small-text">e.g 'wss://ocpp.my-cpms.com/steve/websocket/CentralSystemService'</span>
            </div>
            <p data-bind="visible: config.ocpp_enabled">
              <b data-bind="i18n: 'ocppid'">Charge box ID*:</b>
              <input data-bind="textInput: config.ocpp_chargeBoxId" type="text" autocapitalize="none">
            </p>
            <p data-bind="visible: config.ocpp_enabled">
              <b data-bind="i18n: 'ocppidtag'">ID Tag*:</b>
              <input data-bind="textInput: config.ocpp_idTag" type="text" autocapitalize="none">
            </p>
            <p data-bind="visible: config.ocpp_enabled">
              <b data-bind="i18n: 'ocppspoint'">Transaction start point:</b><br>
              <select data-bind="visible: config.ocpp_enabled,
                                    options: config.supported_tx_start_points,
                                    optionsText: function(item) {
                                      if (item === 'tx_pending') {return 'StartTransaction pending';} else if (item === 'tx_accepted') {return 'StartTransaction accepted';} else {return 'only RemoteStartTransaction';}
                                    },
                                    value: config.tx_start_point"></select>
            </p>
            <p data-bind="visible: config.ocpp_enabled">
              <b data-bind="i18n: 'ocppacccont'">Access control:</b><br>
              <span>
                <input id="ocpp_suspend_evse" type="checkbox" data-bind="checked: config.ocpp_suspend_evse" />
                <label for="ocpp_suspend_evse" data-bind="i18n: 'ocppsuspend'">OCPP can suspend EVSE</label>
              </span><br>
              <span>
                <input id="ocpp_energize_plug" type="checkbox" data-bind="checked: config.ocpp_energize_plug" />
                <label for="ocpp_energize_plug" data-bind="i18n: 'ocppenergize'">OCPP can energize plug</label>
              </span>
            </p>
            <p>
              <button data-bind="i18n: 'save', click: ocppGroup.save, text: (ocppGroup.fetching() ? i18nextko.t('saving') : (ocppGroup.success() ? i18nextko.t('saved') : i18nextko.t('save'))), disable: ocppGroup.fetching">Save</button>
              <span data-bind="visible: config.ocpp_enabled"><b>&nbsp;<span data-bind="i18n: 'connected'"> Connected:</span>&nbsp;<span data-bind="text: 1 === status.ocpp_connected() ? i18nextko.t('yes') : i18nextko.t('no')"></span></b></span>
            </p>
          </div>
        </div>




        <!--end TAB 2-->

        <!--TAB 3: OpenEVSE -->
        <div id="content-3" data-bind="visible: isStatus">

          <!-- Session Status -->
          <div data-bind="visible: status.isError" class="box box-full left error">
            <h4 data-bind="i18n: 'evseerror'">EVSE Error</h4>
            <span data-bind="text: status.estate"></span>
          </div>

          <div data-bind="visible: !status.evse_connected()" class="box box-full left error">
            <h4 data-bind="i18n: 'evseerror'">EVSE Error</h4>
            <span data-bind="i18n: 'evseerrordesc1'">OpenEVSE not responding or not connected</span>
          </div>

          <div data-bind="visible: !status.isError() &amp;&amp; status.evse_connected(),
                          css: { ready: status.isReady(),
                                 connected: status.isConnected() &amp;&amp; !status.isCharging(),
                                 charging: status.isCharging(),
                                 sleeping: status.isPaused() &amp;&amp; 0 == status.vehicle(),
                                 sleeping_connected: status.isPaused() &amp;&amp; 1 == status.vehicle() }"
               class="box box-full left">
            <h2 class="left" data-bind="i18n: 'status'">Status</h2>
            <h2 class="right" data-bind="text: status.estate"></h2>

            <table>
              <tr>
                <th data-bind="i18n: 'current'">Current</th>
                <th data-bind="i18n: 'energy'">Energy</th>
                <th data-bind="i18n: 'temp'">Temp</th>
                <th data-bind="i18n: 'elapsed'">Elapsed</th>
              </tr>
              <tr>
                <td><span data-bind="text: scaleString(status.amp(), 1000, 2) + ' A'"></span></td>
                <td><span data-bind="text: scaleString(status.session_energy(), 1000, 2) + ' kWh'"></span></td>
                <td><span data-bind="text: scaleString(status.temp(), 10, 1) + ' &deg;C'"></span></td>
                <td><span data-bind="text: openevse.time.elapsed"></span></td>
              </tr>
            </table>

            <div data-bind="visible: ecoMode() &amp;&amp; isEcoModeAvailable()">
              <br>
              <span data-bind="visible: haveSolar"><b data-bind="i18n: 'divertsolar'">Solar:</b></span>
              <span data-bind="visible: haveGridIe"><b data-bind="i18n: 'divertgrid'">Grid Import/Export:</b></span>
              <span data-bind="text: haveGridIe() ? status.grid_ie() : status.solar()"></span>W -
              <span data-bind="text: formatUpdate(openevse.time.divert_update()), css: updateClass(openevse.time.divert_update())"></span>
              |
              <span data-bind="visible: status.isReady()"><b data-bind="i18n: 'evnocon'">Vehicle not connected</b></span>
              <span data-bind="visible: status.isSleeping() || (status.isConnected() &amp;&amp; !status.isCharging())"><b data-bind="i18n: 'divertwait'">Waiting for solar</b></span>
              <span data-bind="visible: status.isCharging()"><b data-bind="i18n: 'divertcharge'">Charging from solar</b></span>

              <span data-bind="visible: status.isCharging()">
                | <b data-bind="i18n: 'chargerate'">Charge rate:</b> <span data-bind="text: status.charge_rate"></span>A
              </span>
              <span data-bind="visible: advancedMode">
                <br/>
                <b data-bind="i18n: 'active'">Active:</b> <span data-bind="text: status.divert_active() ? i18nextko.t('yes') : i18nextko.t('no')"></span>
                | <b data-bind="i18n: 'voltage'">Voltage:</b> <span data-bind="text: parseFloat(status.voltage()).toFixed(1)"></span>V
                <span data-bind="visible: status.available_current() !== false">
                  | <b data-bind="i18n: 'avcur'">Available Current:</b> <span data-bind="text: parseFloat(status.available_current()).toFixed(2)"></span>A
                </span>
                <span data-bind="visible: status.smoothed_available_current() !== false">
                  | <b data-bind="i18n: 'smcur'">Smoothed Current:</b>
                  <span data-bind="style: { color: (status.smoothed_available_current() >= status.trigger_current()) ? 'green' : 'red'}">
                    <span data-bind="text: parseFloat(status.smoothed_available_current()).toFixed(2)"></span>A /
                    <span data-bind="text: parseFloat(status.trigger_current()).toFixed(2)"></span>A
                  </span>
                </span>
                <span data-bind="visible: status.min_charge_end() !== false">| <b data-bind="i18n: 'mintimerem'">Min time remaining:</b> <span data-bind="text: status.min_charge_end"></span></span>
              </span>
            </div>

            <div data-bind="visible: advancedMode() &amp;&amp; schedule_plan.active">
              <br>
              <b data-bind="i18n: 'curevent'">Current Event:</b> <span data-bind="text: schedule_plan.current_event_type"></span>, <span data-bind="text: schedule_plan.current_event_time"></span> |
              <b data-bind="i18n: 'nxtevent'">Next Event:</b> <span data-bind="text: schedule_plan.next_event_type"></span>, <span data-bind="text: schedule_plan.next_event_time"></span>
            </div>
          </div>

          <!-- Session Options -->
          <div class="box380 left" data-bind="visible: status.evse_connected">
            <h2 data-bind="i18n: 'chargeopt'">Charge Options</h2>

            <div data-bind="visible: isEcoModeAvailable">
              <span data-bind="i18n: 'modenml', css: {selected: !ecoMode() }">Normal (fast)</span>
              <label class="switch">
                <input type="checkbox" data-bind="checked: ecoMode" />
                <div class="slider round"></div>
              </label>
              <span data-bind="i18n: 'modeeco',css: {selected: ecoMode }">Eco (PV divert)</span><br/>
            </div>

            <p data-bind="visible: !status.isError() &amp;&amp; !ecoMode()">
              <h3 data-bind="i18n: 'manoverride', visible: status.manual_override">Manual Override</h3>
              <button data-bind="i18n: 'start', click: setOverride,
                                 enable: !setOverrideFetching(),
                                 visible: !status.manual_override(),
                                 text: status.isPaused() ? 'Start' : 'Pause'">Start</button>
              <button data-bind="i18n: 'clear', click: clearOverride,
                                 enable: !clearOverrideFetching(),
                                 visible: status.manual_override()">Clear</button>
            </p>

            <span data-bind="visible: !status.isError() &amp;&amp; !ecoMode()">
              <hr \>
              <p>
                <b data-bind="i18n: 'timelimit'">Time limit:</b><br>
                <select data-bind="options: openevse.timeLimits,
                                   optionsText: 'name',
                                   optionsValue: 'value',
                                   value: openevse.timeLimit,
                                   enable: !openevse.updatingTimeLimit() &amp;&amp; status.isConnected(),
                                   css: { saved: openevse.savedTimeLimit }"></select>
              </p>

              <p>
                <b data-bind="i18n: 'energylimit'">Energy limit:</b><br>
                <select data-bind="options: openevse.chargeLimits,
                                   optionsText: 'name',
                                   optionsValue: 'value',
                                   value: openevse.chargeLimit,
                                   enable: !openevse.updatingChargeLimit() &amp;&amp; status.isConnected(),
                                   css: { saved: openevse.savedChargeLimit }" ></select>
              </p>
            </span>

            <hr> <br>
            <div data-bind="with: schedule">
              <b data-bind="i18n: 'timer'">Timer:</b><br>
                <span  data-bind="i18n: 'start'">Start</span>:<input type="time" data-bind="value: delayTimerStart, disable: $root.status.isError" />
                &nbsp;&nbsp;
                  <span data-bind="i18n: 'stop'">Stop</span>: <input type="time" data-bind="value: delayTimerStop, disable: $root.status.isError" /><br/>
                  <span class="small-text" data-bind="visible: $root.config.scheduler_start_window() !== false &amp;&amp; $root.config.scheduler_start_window() > 0">
                    <span data-bind="i18n: 'delaydesc1'">A random delay of up to +/-</span>
                    <span data-bind="text: Math.round($root.config.scheduler_start_window() / 60)"></span>
                    <span data-bind="i18n: 'delaydesc2'">minutes will be applied to the start time to help prevent sudden load increases on the grid.</span>
                    <br />
                </span>
                <br />
                <span data-bind="visible: $root.advancedMode() &amp;&amp; delayTimerEnabled()">
                <b data-bind="i18n: 'delayadj'">Random start adjust:</b><br/>
                <input type="number" data-bind="value: $root.config.scheduler_start_window" min="0" max="1800" step="60" style="width: 80%" /> <span data-bind="i18n: 'seconds'">seconds</span><br />
                <br />
                </span>
                <button data-bind="i18n: 'set', text: delayTimerEnabled() ? 'Update' : 'Set',
                                   enable: !updatingDelayTimer() &amp;&amp;
                                           delayTimerValid() &amp;&amp;
                                           !$root.status.isError(),
                                   click: startDelayTimer">Set</button>
                <button data-bind="i18n: 'cancel', visible: delayTimerEnabled(),
                                   enable: !updatingDelayTimer() &amp;&amp;
                                           !$root.status.isError(),
                                   click: stopDelayTimer">Cancel</button>
            </div>
          </div>

          <!-- Energy -->
          <div class="box380 right" data-bind="visible: advancedMode() &amp;&amp; status.evse_connected()">
            <h2 data-bind="i18n: 'energy'">Energy</h2>
            <table>
              <tr>
                <th data-bind="i18n: 'energy'">Energy</th>
                <th></th>
              </tr>
              <tr>
                <td data-bind="i18n: 'session'">This Session:</td>
                <td><span data-bind="text: scaleString(status.session_energy(), 1000, 2)+ ' kWh'"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'total'">Total:</td>
                <td><span data-bind="text: scaleString(status.total_energy(), 1, 2)+ ' kWh'"></span></td>
              </tr>
            </table>
          </div>

          <!-- Sensor Values -->
          <div class="box380 right" data-bind="visible: advancedMode() &amp;&amp; status.evse_connected()">
            <h2 data-bind="i18n: 'sensorval'">Sensor Values</h2>
            <table>
              <tr>
                <th data-bind="i18n: 'sensor'">Sensor</th>
                <th data-bind="i18n: 'value'">Value</th>
              </tr>
              <tr>
                <td data-bind="i18n: 'pilot'">Pilot:</td>
                <td><span data-bind="text: status.pilot() + ' A'"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'curnow'">Current Now:</td>
                <td><span data-bind="text: scaleString(status.amp(), 1000, 2) + ' A'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.voltage()">
                <td data-bind="i18n: 'voltage'">Voltage:</td>
                <td><span data-bind="text: scaleString(status.voltage(), 1, 2) + ' V'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.temp1()">
                <td><span data-bind="i18n: 'temp'">Temp</span>1:</td>
                <td><span data-bind="text: scaleString(status.temp1(), 10, 1) + ' &deg;C'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.temp2()">
                <td><span data-bind="i18n: 'temp'">Temp</span>2:</td>
                <td><span data-bind="text: scaleString(status.temp2(), 10, 1) + ' &deg;C'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.temp3()">
                <td><span data-bind="i18n: 'temp'">Temp</span>3:</td>
                <td><span data-bind="text: scaleString(status.temp3(), 10, 1) + ' &deg;C'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.temp4()">
                <td><span data-bind="i18n: 'temp'">Temp</span>4:</td>
                <td><span data-bind="text: scaleString(status.temp4(), 10, 1) + ' &deg;C'"></span></td>
              </tr>
            </table>
          </div>

          <!-- Settings -->
          <div class="box380 setup" data-bind="visible: status.evse_connected, css: { right: !advancedMode(), left: advancedMode() }">
            <h2 data-bind="i18n: 'setup'">Setup</h2>
            <p data-bind="visible: !openevse.time.hasRTC()">
              <b data-bind="i18n: 'rtc'">Time: No RTC detected</b>
            </p>
            <p data-bind="with: openevse.time, visible: openevse.time.hasRTC()">
              <b><span data-bind="i18n: 'time'">Time</span>:</b><br/>
              <input type="date" data-bind="value: date, disable: automaticTime" />
              <input type="time" data-bind="value: time, disable: automaticTime" /><br/>
            </p>
            <p data-bind="visible: openevse.time.hasRTC() && false !== config.time_zone() && 'ntp' === timeSource()">
              <b data-bind="i18n: 'timezone'">Time zone:</b><br/>
              <select data-bind="options: zones.zones,
                        optionsText: 'name',
                        optionsValue: 'value',
                        value: time_zone"></select>
            </p>
            <div data-bind="visible: openevse.time.hasRTC()">
              <span data-bind="i18n: 'settimefrom'">Set time from</span>
              <select data-bind="value: timeSource" style="width: 100px">
                <option value="manual" data-bind="i18n: 'manual'">Manual</option>
                <option value="browser" data-bind="i18n: 'browser'">Browser</option>
                <option value="ntp" data-bind="i18n: 'ntp', visible: false !== config.sntp_hostname()">NTP</option>
              </select>
              <button data-bind="click: setTime, text: (setTimeFetching() ? 'Saving' : (setTimeSuccess() ? 'Saved' : 'Set time')), disable: setTimeFetching">Set time</button>
            </div>
            <hr>
            <p>
              <b data-bind="i18n: 'servicelev'">Service Level:</b><br/>
              <select data-bind="options: openevse.serviceLevels,
                                 optionsText: 'name',
                                 optionsValue: 'value',
                                 value: config.service,
                                 disable: openEvseService.fetching,
                                 css: { saved: openEvseService.success }"></select>
            </p>

            <p>
              <b data-bind="i18n: 'maxcur'">Max Current:</b><br/>
              <select data-bind="options: openevse.currentLevels,
                                  optionsText: 'name',
                                  optionsValue: 'value',
                                  value: config.max_current_soft,
                                  disable: openEvseMaxCurrentSoft.fetching,
                                  css: { saved: openEvseMaxCurrentSoft.success }"></select>
            </p>
          </div>

          <!-- Current -->
          <div class="box380 right" data-bind="visible: advancedMode() &amp;&amp; status.evse_connected()">
            <h2 data-bind="i18n: 'current'">Current</h2>
            <table>
              <tr>
                <th data-bind="i18n: 'name'">Name</th>
                <th>
                </th>
              </tr>
              <tr>
                <td data-bind="i18n: 'servicelev'">Service Level:</td>
                <td>
                  <span data-bind="text: status.service_level"></span>
                </td>
              </tr>
              <tr>
                <td><span  data-bind="i18n: 'level'">Level</span>&nbsp;<span data-bind="text: status.service_level"></span>&nbsp;<span data-bind="i18n: 'min'">Minimum:</span></td>
                <td>
                  <span data-bind="text: config.min_current_hard() + ' A'"></span>
                </td>
              </tr>
              <tr>
                <td><span data-bind="i18n: 'level'">Level</span>&nbsp;<span data-bind="text: status.service_level"></span>&nbsp;<span data-bind="i18n: 'max'">Maximum:</span></td>
                <td>
                  <span data-bind="text: config.max_current_hard() + ' A'"></span>
                </td>
              </tr>
              <tr>
                <td data-bind="i18n: 'ssrscale'">Sensor Scale:</td>
                <td><span data-bind="text: config.scale"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'ssroff'">Sensor Offset:</td>
                <td><span data-bind="text: config.offset"></span></td>
              </tr>
            </table>
          </div>

          <!-- Safety -->
          <div class="box380 left" data-bind="visible: status.evse_connected() &amp;&amp; (advancedMode() || !config.all_tests_enabled())">
            <h2 data-bind="i18n: 'safety'">Safety<span class="info" data-bind="click: toggle.bind($data, showSafety)"></span></h2>

            <div class="box" data-bind="i18n: 'safetydesc', visible: showSafety()">
              Hardware safety checks. Enable dev mode (System / Developer Mode) to enable/disable or use the physical LCD + menu button.
            </div>

            <div data-bind="visible: !config.all_tests_enabled()" class="box warning">
              <h4 data-bind="i18n: 'warning'">Warning!!</h4>
              <span data-bind="i18n: 'safetywarn'">Not all the safety tests are enabled, please take extra care before charging your vehicle.</span>
            </div>

            <table>
              <tr>
                <th data-bind="i18n: 'test'">Test</th>
                <th data-bind="i18n: 'status'">Status</th>
              </tr>
              <tr data-bind="css: {error: 9 === status.state() }">
                <td data-bind="i18n: 'gfcitest'">GFCI Self Test:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.gfci_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.gfci_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr data-bind="css: {error: 7 === status.state() }">
                <td data-bind="i18n: 'gndmon'">Ground Monitoring:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.ground_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.ground_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr data-bind="css: {error: 8 === status.state() }">
                <td data-bind="i18n: 'stckctdet'">Stuck Contact Detection:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.relay_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.relay_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr data-bind="css: {error: 10 === status.state() }">
                <td data-bind="i18n: 'tempmon'">Temperature Monitoring:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.temp_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.temp_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr data-bind="css: {error: 5 === status.state() }">
                <td data-bind="i18n: 'diodechk'">Diode Check:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.diode_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.diode_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr data-bind="css: {error: 4 === status.state() }">
                <td data-bind="i18n: 'ventrq'">Vent Required:</td>
                <td>
                  <label class="switch" data-bind="visible: developerMode">
                    <input type="checkbox" data-bind="checked: config.vent_check" />
                    <div class="slider round"></div>
                  </label>
                  <span data-bind="text: config.vent_check() ? 'Enabled' : 'Disabled'"></span>
                </td>
              </tr>
              <tr>
                <th data-bind="i18n: 'error'">Error</th>
                <th data-bind="i18n: 'count'">Count</th>
              </tr>
              <tr>
                <td data-bind="i18n: 'gfci'">GFCI:</td>
                <td><span data-bind="text: status.gfcicount"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'nognd'">No Ground:</td>
                <td><span data-bind="text: status.nogndcount"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'stkct'">Stuck Contact:</td>
                <td><span data-bind="text: status.stuckcount"></span></td>
              </tr>
            </table>
          </div>

          <!-- Hardware -->
          <div class="box380 right" data-bind="visible: advancedMode() &amp;&amp; status.evse_connected()">
            <h2 data-bind="i18n: 'hardware'">Hardware</h2>
            <table>
              <tr>
                <th data-bind="i18n: 'openevse'">OpenEVSE</th>
                <th></th>
              </tr>
              <tr>
                <td data-bind="i18n: 'firmware'">Firmware:</td>
                <td><span data-bind="text: config.firmware"></span></td>
              </tr>
              <tr>
                <td colspan="2" data-bind="with: openevse">
                  <button data-bind="click: restart, text: (restartFetching() ? 'Restarting...' : 'Restart'), disable: restartFetching">Restart</button>
                </td>
              </tr>
              <tr>
                <th data-bind="i18n: 'openevsewifi'">OpenEVSE WiFi</th>
                <th></th>
              </tr>
              <tr data-bind="visible: false !== config.buildenv()">
                <td data-bind="i18n: 'fwconf'">Firmware config:</td>
                <td><span data-bind="text: config.buildenv"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'fwver'">Firmware version:</td>
                <td><span data-bind="text: config.version"></span></td>
              </tr>
              <tr data-bind="visible: false !== config.espinfo()">
                <td data-bind="i18n: 'espinfo'">ESP info:</td>
                <td><span data-bind="text: config.espinfo"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'flashsz'">Flash Size:</td>
                <td><span data-bind="text: scaleString(config.espflash(), 1024, 0) + 'K'"></span></td>
              </tr>
              <tr>
                <td data-bind="i18n: 'freeram'">Free RAM:</td>
                <td><span data-bind="text: scaleString(status.free_heap(), 1024, 0) + 'K'"></span></td>
              </tr>
              <tr>
                <td colspan="2">
                  <button data-bind="i18n: 'restart', click: restart, text: (restartFetching() ? i18nextko.t('restarting') : i18nextko.t('restart')), disable: restartFetching">Restart</button>
                </td>
              </tr>
            </table>
          </div>

          <div class="box380 right" data-bind="visible: advancedMode() &amp;&amp; status.evse_connected()">
            <h2 data-bind="i18n: 'evsettings'">Vehicle Settings</h2>
            <h3><span data-bind="i18n: 'evpause'">Pause status </span><span class="info" data-bind="click: toggle.bind($data, showVehiclePauseStatus)"></span></h3>
            <div class="box" data-bind="i18n: 'evpausedesc', visible: showVehiclePauseStatus()">
              Some vehicles will shutdown if left in sleep mode (pilot signal enable) and then can not be woken up by timers/PV divert. Changing the
              pause state to disable should resolve this issue, however this removes the ability for the charger to detect if a vehicle is connected
              when paused.
            </div>
            <div>
              <span data-bind="i18n: 'sleep', css: {selected: !config.pause_uses_disabled() }">Sleep</span>
              <label class="switch">
                <input type="checkbox" data-bind="checked: config.pause_uses_disabled" />
                <div class="slider round"></div>
              </label>
              <span data-bind="css: {selected: config.pause_uses_disabled }">Disable</span><br/>
            </div>
          </div>

          <div class="box380" data-bind="visible: status.evse_connected,
                                         css: { right: !advancedMode() &amp;&amp; !config.all_tests_enabled(),
                                                left: advancedMode() || config.all_tests_enabled() }">
            <h2 data-bind="i18n: 'display'">Display</h2>
            <div>
              <span data-bind="i18n: 'simple', css: {selected: !advancedMode() }">Simple</span>
              <label class="switch">
                <input type="checkbox" data-bind="checked: advancedMode" />
                <div class="slider round"></div>
              </label>
              <span data-bind="i18n: 'advanced', css: {selected: advancedMode }">Advanced</span><br/>
            </div>

            <hr/>

            <p data-bind="visible: config.led_brightness() !== false">
              <b data-bind="i18n: 'brightness'">LED Brightness:</b><br>
              <span class="rangeslidercontainer">
                <input type="range" min="0" max="255" class="rangeslider"
                       data-bind="value: config.led_brightness,
                                  disable: displayGroup.fetching(),
                                  css: { saved: displayGroup.success }">
              </span>
            </p>
            <!--p>
              <button data-bind="click: displayGroup.save,
                                 text: (displayGroup.fetching() ? 'Saving' :
                                       (displayGroup.success() ? 'Saved' : 'Save')),
                                 disable: displayGroup.fetching">Save</button>
            </p-->
          </div>

          <div class="box box-full left">
            <h2 class="left" data-bind="i18n: 'history'">History</h2>

            <table>
              <thead>
                <tr>
                  <th data-bind="i18n: 'time'">Time</th>
                  <th data-bind="i18n: 'type'">Type</th>
                  <th data-bind="i18n: 'status'">Status</th>
                  <th data-bind="i18n: 'energy'">Energy</th>
                  <th data-bind="i18n: 'temp'">Temp</th>
                </tr>
              </thead>
              <tbody data-bind="foreach: logs.events">
                <tr>
                  <td><span data-bind="text: localTime"></span></td>
                  <td><span data-bind="text: type"></span></td>
                  <td><span data-bind="text: estate"></span></td>
                  <td><span data-bind="text: scaleString(energy(), 1000, 2) + ' kWh'"></span></td>
                  <td><span data-bind="text: scaleString(temperatureMax(), 1, 1) + ' &deg;C'"></span></td>
                </tr>
              </tbody>
              <tfoot data-bind="visible: logs.hasMore, disable: logs.fetchingBlock">
                <tr>
                  <td colspan="5" data-bind="click: logs.updateNext, clickBubble: false" style="text-align: center;"><span style="cursor: pointer" data-bind="i18n: 'loadmore'">Load more</span></td>
                </tr>
              </tfoot>
            </table>
          </div>

        </div>
        <!--end tab 3-->

        <!--TAB 4: RAPI -->
        <div id="content-4" data-bind="visible: isRapi() &amp;&amp; status.evse_connected()">
          <div class="box box-full left">
            <form method="get" action="r" data-bind="with: rapi">
              <p>
                <b>RAPI Command:</b>
                <div data-bind="html: history"></div>
                <input type="text" autocapitalize="none" name="rapi" length="32" data-bind="textInput: cmd" />
              </p>
              <p>
                <button data-bind="click: send, disable: rapiSend">Send</button>
                <button data-bind="click: clear">Clear</button>
              </p>
            </form>
          </div>
          <div class="box box-full left">
            <h2>RAPI Get Commands</h2>
            <button data-bind="click: rapi.read, disable: rapi.reading">Read</button>
            <table data-bind="with: rapi">
              <thead>
                <tr>
                  <th>Get</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody data-bind="foreach: get_commands">
                <tr>
                  <td data-bind="text: cmd"></td>
                  <td>
                    <span data-bind="html: description"></span><br/>
                    <dl data-bind="foreach: tokens">
                      <dt data-bind="text: name"></dt>
                      <dd data-bind="html: description"></dd>
                    </dl>
                    <div data-bind="visible: ret() != ''">
                      <span data-bind="text: ret, css: { error: ret().startsWith('$NK'), ok: ret().startsWith('$OK')}"></span><br/>
                      <div data-bind="foreach: tokens, visible: ret().startsWith('$OK')">
                        <span data-bind="text: name"></span> = <span data-bind="text: val"></span><br/>
                        <span data-bind="if: $data.hasOwnProperty('parsed')">
                          <ul data-bind="foreach: parsed">
                            <li>
                              <span data-bind="if: $data.hasOwnProperty('name')">
                                <span data-bind="text: name"></span> =
                              </span>
                              <span data-bind="text: val"></span>
                            </li>
                          </ul>
                        </span>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="box380 left">
            <h2>RAPI Set Commands</h2>
            <table>
              <tr>
                <th>Set</th>
                <th>Description</th>
              </tr>
              <tr>
                <td>$S0</td>
                <td>Set LCD Type, Monochrome (0), Color (1)</td>
              </tr>
              <tr>
                <td>$S1</td>
                <td>Set RTC, year month day hour minute second (all 2-digit max)</td>
              </tr>
              <tr>
                <td>$S2</td>
                <td>Enable (1)/ Disable (0) Ammeter Calibration Mode</td>
              </tr>
              <tr>
                <td>$S3</td>
                <td>Set Charge Time Limit, 15-minutes (1), 30-minutes (2), etc...</td>
              </tr>
              <tr>
                <td>$SA</td>
                <td>Set Ammeter Scale/Offset, scale offset</td>
              </tr>
              <tr>
                <td>$SC</td>
                <td>Set current capacity, integer</td>
              </tr>
              <tr>
                <td>$SH</td>
                <td>Set charge limit in kWh, integer</td>
              </tr>
              <tr>
                <td>$SK</td>
                <td>Set accumulated Wh, integer</td>
              </tr>
              <tr>
                  <td>$SL</td>
                  <td>Set service level (1/2/A)</td>
              </tr>
              <tr>
                <td>$SM</td>
                <td>Set Voltmeter Scale/Offset, scale offset</td>
              </tr>
              <tr>
                <td>$ST</td>
                <td>Set timer, start_hour start_min end_hour end_min</td>
              </tr>
              <tr>
                <td>$SV</td>
                <td>Set voltage for power calculations, millivolts</td>
              </tr>
            </table>
          </div>
          <div class="box380 right">
            <h2>RAPI System Functions</h2>
            <table>
              <tr>
                <th>Function</th>
                <th>Description</th>
              </tr>
              <tr>
                <td>$FB</td>
                <td>LCD Backlight Color (0-7)</td>
              </tr>
              <tr>
                <td>$FD</td>
                <td>Disable EVSE</td>
              </tr>
              <tr>
                <td>$FE</td>
                <td>Enable EVSE</td>
              </tr>
              <tr>
                <td>$FP</td>
                <td>Output text at x y position text to LCD (x y text)</td>
              </tr>
              <tr>
                <td>$FR</td>
                <td>Reset EVSE</td>
              </tr>
              <tr>
                <td>$FS</td>
                <td>Put EVSE to sleep</td>
              </tr>
              <tr>
                <td>$FF</td>
                <td>Enable/disable feature (feature_id 0|1)<br>
                    Front panel (B)utton, (D)iode check, G(F)I self-test, (G)round check,
                    Stuck (R)elay check, (T)emp monitoring, (V)ent required</td>
              </tr>
            </table>
          </div>
        </div>
        <!--end TAB 4-->

        <!--TAB 5: Vehicle -->
        <div id="content-5" data-bind="visible: isVehicle">
          <div class="box380 left">
            <h2 data-bind="i18n: 'setup'">Setup</h2>
            <select data-bind="value: vehicle.type">
              <option value="none" data-bind="i18n: 'none'">None</option>
              <option value="tesla" data-bind="i18n: 'tesla'">Tesla</option>
              <!-- option value="ovms">OVMS</option -->
              <option value="mqtt" data-bind="i18n: 'mqtt'">MQTT</option>
            </select>

            <div data-bind="visible: 'none' == vehicle.type()">
              <p data-bind="i18n: 'selectevcon'">Select the vehicle connection type</p>
              <hr/>
              <h3 data-bind="i18n: 'httppush'">HTTP Push</h3>
              <p>

                <div>
                  <p>
                    <span data-bind="i18n: 'httppushinfo'">To update manually vehicule data, send HTTP POST request to:</span>
                    <br>
                    <b>http://{OPENEVSE IP}/status</b>
                    <br>
                  </p>
                  
                  <div data-bind="i18n: 'httppushinfo2'">
                    containing json data in body:
                  </div>
                    <pre id="json">
{
  "battery_level": int, // SOC (%)
  "battery_range": int, // Range (km/miles)
  "time_to_full_charge": int // charge ETA (sec)
}
                    </pre>
                  
                </div>
              </p>

            </div>
            <div data-bind="visible: 'tesla' == vehicle.type()">
              <hr/>
              <h3 data-bind="i18n: 'tesla'">Tesla</h3>
              <p data-bind="visible: !vehicle.tesla.have_credentials() &amp;&amp; !vehicle.tesla.advanced()">
                <b data-bind="i18n: 'username'">Username:</b>
                <input data-bind="textInput: vehicle.tesla.username" type="text" autocapitalize="none">
              </p>
              <p data-bind="visible: !vehicle.tesla.have_credentials() &amp;&amp; !vehicle.tesla.advanced()">
                <b data-bind="i18n: 'password'">Password:</b>
                <input type="password" autocapitalize="none" data-bind="textInput: vehicle.tesla.password" /><br />
                <!--span>
                  <input id="mqttPassword" type="checkbox" data-bind="checked: mqttPassword.show" />
                  <label for="mqttPassword">Show password</label>
                </span-->
              </p>
              <p data-bind="visible: !vehicle.tesla.have_credentials() &amp;&amp; vehicle.tesla.advanced()">
                <b data-bind="i18n: 'accesstoken'">Access token</b>
                <input data-bind="textInput: config.tesla_access_token" type="password" autocapitalize="none">
                <!--span>
                  <input id="mqttPassword" type="checkbox" data-bind="checked: mqttPassword.show" />
                  <label for="mqttPassword">Show password</label>
                </span-->
              </p>
              <p data-bind="visible: !vehicle.tesla.have_credentials() &amp;&amp; vehicle.tesla.advanced()">
                <b data-bind="i18n: 'reftoken'">Refresh token</b>
                <input data-bind="textInput: config.tesla_refresh_token" type="password" autocapitalize="none">
                <!--span>
                  <input id="mqttPassword" type="checkbox" data-bind="checked: mqttPassword.show" />
                  <label for="mqttPassword">Show password</label>
                </span-->
              </p>
              <div class="box" data-bind="visible: showTeslaAdvancedInfo()">
                T<span data-bind="i18n: 'teslalogindesc1'">The Tesla login may break from time-to-time as Tesla change their login API, hopefully OpenEVSE will be able to resolve the
                issue on </span>
                <a href="https://github.com/OpenEVSE/ESP32_WiFi_V4.x/tree/master/tesla_login" target="_blank">
                  <span data-bind="i18n: 'teslalogindesc2'">our server</span>
                </a>,
                <span data-bind="i18n: 'teslalogindesc3'">but should the login fail you can use a 3rd Party app to generate the appropriate tokens.</span>

                <ul>
                  <li><b data-bind="i18n: 'apple'">Apple</b>: <a href="https://apps.apple.com/us/app/auth-app-for-tesla/id1552058613" target="_blank">Auth app for Tesla</a></li>
                  <li><b data-bind="i18n: 'android'">Android</b>: <a href="https://play.google.com/store/apps/details?id=net.leveugle.teslatokens&hl=en_GB&gl=US" target="_blank">Tesla Tokens</a></li>
                </ul>

                <span data-bind="i18n: 'teslalogindesc4'">These can be entered in the `Advanced` section as an alternative method of logging in.</span>
              </div>
              <p data-bind="visible: vehicle.tesla.have_credentials()">
                <select data-bind="options: vehicle.tesla.vehicles,
                  optionsText: 'name',
                  optionsValue: 'id',
                  value: config.tesla_vehicle_id,
                  visible: vehicle.tesla.vehicles().length > 0">
                </select>
                <span data-bind="visible: 0 == vehicle.tesla.vehicles().length">
                  <span data-bind="i18n: 'evfetching'">Fetching vehicle info ...</span>
                </span>
              </p>
            </div>

            <div data-bind="visible: 'ovms' == vehicle.type()">
              <hr/>
              <h3 data-bind="i18n: 'ovms'">Open Vehicle Monitoring System</h3>

            </div>

            <div data-bind="visible: 'mqtt' == vehicle.type()">
              <hr/>
              <h3 data-bind="i18n: 'mqtt'">MQTT</h3>

              <div class="box error" data-bind="visible: !config.mqtt_enabled()">
                <h4 data-bind="i18n: 'nomqtt'">MQTT not enabled.</h4>
                <span data-bind="i18n: 'nomqttdesc'">You need to enable MQTT on the <a href="#services">Services</a> tab.</span>
              </div>

              <p data-bind="visible: config.mqtt_enabled()">
                <b data-bind="i18n: 'soctopic'">State of Charge topic:</b><br>
                <input data-bind="textInput: config.mqtt_vehicle_soc" type="text" autocapitalize="none"><br>
                <span class="small-text" data-bind="i18n: 'socdesc'">The battery level of charge as a percentage</span>
              </p>

              <div data-bind="visible: config.mqtt_enabled()">
                <b data-bind="i18n: 'rangetopic'">Range topic:</b><br>
                <div class="divert">
                  <input data-bind="textInput: config.mqtt_vehicle_range" type="text" autocapitalize="none">
                  <select data-bind="value: vehicle.mqtt_vehicle_range_units">
                    <option value="km" data-bind="i18n: 'km'">km</option>
                    <option value="mi" data-bind="i18n: 'miles'">miles</option>
                  </select><br/>
                  <span class="small-text" data-bind="i18n: 'rangedesc'">The range (on electric) of the vehicle based on the current battery level</span>
                </div>
              </div>

              <p data-bind="visible: config.mqtt_enabled()">
                <b data-bind="i18n: 'timetopic'">Time to charge topic:</b><br>
                <input data-bind="textInput: config.mqtt_vehicle_eta" type="text" autocapitalize="none"><br>
                <span class="small-text" data-bind="i18n: 'timedesc'">The time until the battery is fully charged in seconds</span>
              </p>

            </div>

            <p data-bind="">
              <button data-bind="i18n: 'save',
                                 visible: vehicle.show_save(),
                                 click: vehicleStateGroup.save,
                                 text: (vehicleStateGroup.fetching() ? i18nextko.t('saving') : (vehicleStateGroup.success() ? i18nextko.t('saved') : i18nextko.t('save'))),
                                 disable: vehicleStateGroup.fetching">
                Save
              </button>
              <button data-bind="i18n: 'login',
                                 visible: !vehicle.tesla.have_credentials() && !vehicle.show_save(),
                                 click: vehicle.tesla.login,
                                 text: (vehicle.tesla.fetching() ? i18nextko.t('saving') : (vehicle.tesla.success() ? i18nextko.t('saved') : i18nextko.t('login'))),
                                 disable: vehicle.tesla.fetching">
                Login
              </button>
              <button data-bind="i18n: 'advanced',
                                 visible: !vehicle.tesla.have_credentials() && !vehicle.show_save(),
                                 click: vehicle.tesla.showAdvanced">
                Advanced
              </button>
              <span class="info" data-bind="visible: !vehicle.tesla.have_credentials() && !vehicle.show_save(),
                                            click: toggle.bind($data, showTeslaAdvancedInfo)"></span>
              <button data-bind="i18n: 'logout',
                                 visible: vehicle.tesla.have_credentials(),
                                 click: vehicle.tesla.logout,
                                 text: (vehicle.tesla.fetching() ? i18nextko.t('saving') : (vehicle.tesla.success() ? i18nextko.t('saved') : i18nextko.t('logout'))),
                                 disable: vehicle.tesla.fetching">
                Logout
              </button>
            </p>

          </div>

          <div class="box380 right error" data-bind="visible: false !== status.tesla_error()">
            <h4 data-bind="i18n: 'error'">Error</h4>
            <span data-bind="text: status.tesla_error"></span>
          </div>

          <div class="box380 right" data-bind="visible: vehicle.has_status">
            <h2 data-bind="i18n: 'status'">Status</h2>
            <table>
              <tr>
                <th data-bind="i18n: 'status'">Status</th>
                <th><span data-bind="text: formatUpdate(openevse.time.vehicle_state_update()), css: updateClass(openevse.time.vehicle_state_update())"></span></th>
              </tr>
              <tr data-bind="visible: false !== status.battery_level()">
                <td data-bind="i18n: 'battlvl'">Battery Level:</td>
                <td><span data-bind="text: status.battery_level()+ '%'"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.battery_range()">
                <td data-bind="i18n: 'battrng'">Battery Range:</td>
                <td><span data-bind="text: status.battery_range() + ' ' + (vehicle.mqtt_vehicle_range_units())"></span></td>
              </tr>
              <tr data-bind="visible: false !== status.time_to_full_charge()">
                <td data-bind="i18n: 'timefchg'">Time to full charge:</td>
                <td><span data-bind="text: new Date(status.time_to_full_charge() * 1000).toISOString().substr(11, 8)"></span></td>
              </tr>
            </table>
          </div>
        </div>
        <!--end TAB 5-->

      </div>
      <!--end content-->

      <div id="footer">
        <br><b> Powered by <a href="http://www.openevse.com" data-bind="i18n: 'openevse'">OpenEVSE</a> and <a href="https://openenergymonitor.org">OpenEnergyMonitor</a></b>
        <br>
        <b>Version: </b>V<span data-bind="text: config.version"></span>
      </div>
    </div>
    <!--end container -->
  </div>

  <!--end page -->
  <script src="jquery.js"></script>
  <script src="lib.js"></script>
  <script src="home.js"></script>
  <script src="localisation.js"></script>

</body>

</html>
